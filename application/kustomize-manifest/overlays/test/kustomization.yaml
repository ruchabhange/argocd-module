apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

bases:
  - ../../base

commonLabels:
  purpose: Argocd-demo
  env : test

nameSuffix: -test

replicas:
  - name: web-frontend
    count: 2
  - name: customers-v2
    count: 3

patches:
  - target:
      kind: Deployment
      name: web-frontend
    patch: |-
      - op: replace
        path: /spec/template/spec/containers/0/env/0/value
        value: 'http://customers.test-app.svc.cluster.local'

pathches:
  - target:
      kind: Deployment
      name: web-frontend
    patch: |-
      - op: replace
        path: /spec/template/spec/containers/0/image
        value: 'gcr.io/tetratelabs/web-frontend:1.0.0'
        
pathches:
  - target:
      kind: Deployment
      name: customers
    patch: |-
      - op: replace
        path: /spec/template/spec/containers/0/image
        value: 'gcr.io/tetratelabs/customers:1.0.0'
